<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}HR Operations Toolkit{% endblock %} - [24]7.ai</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-in': 'slideIn 0.3s ease-out forwards',
                        'pulse-soft': 'pulseSoft 2s ease-in-out infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideIn: {
                            '0%': { opacity: '0', transform: 'translateX(-20px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' },
                        },
                        pulseSoft: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.8' }
                        }
                    },
                },
            },
        }
    </script>
    <style>
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .tool-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .tool-card:hover {
            transform: translateY(-4px) scale(1.02);
        }
        .loading-spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid #f97316;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-slate-50 dark:bg-slate-900 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    {% include 'components/header.html' %}

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'components/footer.html' %}

    <!-- Help Modal -->
    {% include 'components/help_modal.html' %}

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Theme management
            const themeToggle = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('theme-icon-sun');
            const moonIcon = document.getElementById('theme-icon-moon');
            const htmlEl = document.documentElement;

            // Load saved theme or default to dark
            const savedTheme = localStorage.getItem('theme') || 'dark';
            htmlEl.classList.add(savedTheme);
            updateIcon(savedTheme);

            function updateIcon(theme) {
                if (theme === 'dark') {
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                } else {
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                }
            }

            themeToggle.addEventListener('click', () => {
                const newTheme = htmlEl.classList.contains('dark') ? 'light' : 'dark';
                htmlEl.classList.remove('dark', 'light');
                htmlEl.classList.add(newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcon(newTheme);
            });

            // Help modal management
            const helpButton = document.getElementById('help-button');
            const helpModal = document.getElementById('help-modal');
            const modalCloseButton = document.getElementById('modal-close-button');
            const modalContent = document.getElementById('help-modal-content');

            if (helpButton && helpModal) {
                helpButton.addEventListener('click', () => {
                    helpModal.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                });
            }

            if (modalCloseButton && helpModal) {
                modalCloseButton.addEventListener('click', () => {
                    helpModal.classList.add('hidden');
                    document.body.style.overflow = '';
                });
            }

            if (helpModal) {
                helpModal.addEventListener('click', (e) => {
                    if (e.target === helpModal) {
                        helpModal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                });
            }

            if (modalContent) {
                modalContent.addEventListener('click', (e) => e.stopPropagation());
            }

            // Search functionality
            const searchInputs = ['search-input', 'mobile-search-input'];
            searchInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', (e) => {
                        const query = e.target.value.toLowerCase();
                        filterTools(query);
                    });
                }
            });

            // Tool filtering function
            function filterTools(query) {
                const toolCards = document.querySelectorAll('.tool-card');
                toolCards.forEach(card => {
                    const toolName = card.querySelector('h3')?.textContent.toLowerCase() || '';
                    const toolDesc = card.querySelector('p')?.textContent.toLowerCase() || '';

                    if (toolName.includes(query) || toolDesc.includes(query)) {
                        card.style.display = '';
                        card.classList.remove('opacity-50', 'scale-95');
                    } else {
                        card.style.display = query ? 'none' : '';
                    }
                });
            }

            // Add loading states to buttons
            document.querySelectorAll('button[type="submit"]').forEach(button => {
                button.addEventListener('click', function() {
                    if (!this.disabled) {
                        const originalContent = this.innerHTML;
                        this.innerHTML = '<div class="loading-spinner inline-block mr-2"></div> Processing...';
                        this.disabled = true;

                        // Reset after 5 seconds as fallback
                        setTimeout(() => {
                            this.innerHTML = originalContent;
                            this.disabled = false;
                        }, 5000);
                    }
                });
            });

            // Initialize tooltips
            document.querySelectorAll('[title]').forEach(element => {
                element.classList.add('cursor-help');
            });

            // Smooth scroll for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });

        // Global utility functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 p-4 rounded-lg shadow-lg z-50 animate-slide-in max-w-sm ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-blue-500 text-white'
            }`;

            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' :
                        'fa-info-circle'
                    } mr-2"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function downloadFile(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>